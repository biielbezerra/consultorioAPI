# consultorioAPI

[Routing](https://start.ktor.io/p/routing-default)

```
2024-12-04 14:32:45.584 [main] INFO  Application - Application started in 0.303 seconds.
2024-12-04 14:32:45.682 [main] INFO  Application - Responding at http://0.0.0.0:8080
```

## Rotas disponíveis

| Rotas                                                                  | Tipo   | Descrição                                                                                                                                                                                                                                                                                                                                                                                                               |
|------------------------------------------------------------------------|--------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `/auth/register/paciente`                                              | POST   | Paciente se registra no Firebase e BD local como User e Paciente.                                                                                                                                                                                                                                                                                                                                                       | 
| `/auth/completar-cadastro`                                             | POST   | Profissional/Recepcionista aceita convite para se juntar à equipe do consultório.                                                                                                                                                                                                                                                                                                                                       |
| `/auth/recusar-convite`                                                | POST   | Profissional/Recepcionista recusa convite para se juntar à equipe do consultório.                                                                                                                                                                                                                                                                                                                                       |
| `/usuarios/me`                                                         | GET    | Busca Perfil.                                                                                                                                                                                                                                                                                                                                                                                                           |
| `/usuarios/me`                                                         | PUT    | Atualiza perfil.                                                                                                                                                                                                                                                                                                                                                                                                        |
| `/usuarios/me`                                                         | DELETE | Exclui perfil - soft delete e anonimização do paciente. (auto exclusão)                                                                                                                                                                                                                                                                                                                                                 |
| `/usuarios/me/seguranca`                                               | POST   | Atualiza senha.                                                                                                                                                                                                                                                                                                                                                                                                         |
| `/pacientes/{id}/consultas`                                            | GET    | Listar consultas pelo paciente.                                                                                                                                                                                                                                                                                                                                                                                         ||                                         |        |                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `/admin/profissionais`                                                 | GET    | Listar profissionais.                                                                                                                                                                                                                                                                                                                                                                                                   |
| `/admin/consultorio`                                                   | POST   | Criar consultório.                                                                                                                                                                                                                                                                                                                                                                                                      |
| `/admin/usuarios/equipe`                                               | POST   | Enviar convite de cadastro para profissional ou recepcionista.                                                                                                                                                                                                                                                                                                                                                          |
| `/admin/usuarios/{id}/reenviar-convite`                                | POST   | Reenviar convite em caso de recusa ou não respondido.                                                                                                                                                                                                                                                                                                                                                                   |
| `/admin/usuarios/{id}`                                                 | DELETE | Exclui perfil - soft delete e anonimização do profissional ou recepcionista sendo um SuperAdmin.                                                                                                                                                                                                                                                                                                                        |
| `/admin/promocoes`                                                     | POST   | SuperAdmin cria promoções de escopo Global (qualquer profissional pode optar por ativar/aderar para suas consultas ou não.                                                                                                                                                                                                                                                                                              |
| `/admin/usuarios/{id}/status`                                          | PUT    | Atualiza o status da equipe (profissionais ou recepcionistas) - Ativo ou Inativo.                                                                                                                                                                                                                                                                                                                                       |
| `/admin/usuarios/linkar-perfil`                                        | POST   | 1. Admin digita o e-mail no formulário "Cadastrar Equipe".<br/>2. O frontend chama POST /admin/usuarios/equipe.<br/>3. A API retorna o 409 Conflict ("Este email já está em uso.").<br/>4. frontend vê o 409 e mostra "Este e-mail já pertence a um usuário. Deseja linkar um perfil de Profissional a esta conta?".<br/>5. Se o Admin clicar "Sim", o frontend chama a outra rota: POST /admin/usuarios/linkar-perfil. |                                                                                                                                                                                                                                                                                                                                                                                                                     |
| `/admin/transferir-propriedade`                                        | POST   | SuperAdmin transfere permissão de SuperAdmin. <br/>Se for pessoa existente: transfere propriedade. <br/>Se for pessoa inexistente, envia convite para aceitação no e-mail. <br/>Se o admin antigo também era um Profissional, cancele suas consultas e avisa paciente. <br/>Safe delete se optar (caso era profissional existente).                                                                                     |
| `/admin/emails/bloqueados`                                             | GET    | Listar os e-mails de pacientes bloqueados.                                                                                                                                                                                                                                                                                                                                                                              |
| `/admin/emails/desbloquear`                                            | POST   | Desbloquear paciente que foi bloqueado por algum motivo.                                                                                                                                                                                                                                                                                                                                                                |
| `/admin/manutencao`                                                    | POST   | Executa manutenção diária do servidor manualmente:<br/>Atualiza Status de pacientes, se estão ativos, se já faz muito tempo que não tem uma consulta.<br/>Atualiza agenda, janela deslizante adicionando mais 1 dia no final da agenda assim que 1 dia se encerra.                                                                                                                                                      |
| `/consultas`                                                           | POST   | Agendar consulta.                                                                                                                                                                                                                                                                                                                                                                                                       |
| `/consultas/dupla`                                                     | POST   | Agendar consulta dupla.                                                                                                                                                                                                                                                                                                                                                                                                 |
| `/consultas/pacote`                                                    | POST   | Agendar consulta por pacote (de acordo com a quantidade definida do pacote e desconto por consulta). Se o paciente compra um pacote de 3, o frontend (seu app) deve exibir 3 calendários para ele escolher 3 datas (data1, data2, data3).                                                                                                                                                                               |
| `/consultas/{id}/reagendar`                                            | PUT    | Reagendar consulta.                                                                                                                                                                                                                                                                                                                                                                                                     |
| `/consultas/{id}/cancelar`                                             | POST   | Cancelar consulta.                                                                                                                                                                                                                                                                                                                                                                                                      |
| `/consultas/{id}/finalizar`                                            | POST   | Finalizar consulta (pelo profissional ou recepcionista para confirmar se a consulta foi realizada ou se o paciente não compareceu).                                                                                                                                                                                                                                                                                     |
| `/profissionais/{id}/agenda-config`                                    | PUT    | Configuração inicial da agenda, onde o profissional define os dias/horários e locais de trabalho.                                                                                                                                                                                                                                                                                                                       |
| `/profissionais/{id}/valor-consulta`                                   | PUT    | Profissional define seu valor da consulta (valor padrão: 200 reais).                                                                                                                                                                                                                                                                                                                                                    |
| `/profissionais/{id}/agenda/status`                                    | GET    | Retorna o status de cada slote da agenda (DISPONIVEL, OCUPADO, PASSADO ou FORA_DO_HORARIO_DE_TRABALHO).                                                                                                                                                                                                                                                                                                                 |
| `/profissionais/{id}/horarios-disponiveis`                             | GET    | Retorna todos os slots/horários disponíveis do profissional, sem filtro.                                                                                                                                                                                                                                                                                                                                                |
| `/profissionais/{id}/consultorio/{consultorioId}/horarios-disponiveis` | GET    | Retorna todos os slots/horários disponíveis do profissional por consultório.                                                                                                                                                                                                                                                                                                                                            |
| `/profissionais/{id}/consultas`                                        | GET    | Retorna todas as consultas do profissional.                                                                                                                                                                                                                                                                                                                                                                             |
| `/profissionais/{id}/agenda/folga`                                     | POST   | Define um dia inteiro de folga.                                                                                                                                                                                                                                                                                                                                                                                         |
| `/profissionais/{id}/promocoes/{promocaoId}/ativar`                    | POST   | Ativa promoção existente.                                                                                                                                                                                                                                                                                                                                                                                               |
| `/profissionais/{id}/promocoes/{promocaoId}/desativar`                 | DELETE | Desativar promoção existente.                                                                                                                                                                                                                                                                                                                                                                                           |
| `/profissionais/{id}/promocoes-disponiveis`                            | GET    | Retorna todas as promoções que o profissional pode ativar para suas consultas.                                                                                                                                                                                                                                                                                                                                          |
| `/cron/manutencao`                                                     | POST   | Rota para execução de Cron Service para manutenção diária do servidor automaticamente.                                                                                                                                                                                                                                                                                                                                  |